(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();let d=null,v=!1;typeof OpenGameSDK<"u"&&(d=new OpenGameSDK({ui:{usePointsWidget:!0,theme:"light"},logLevel:1}),d.on("OnReady",()=>{console.log("Play.fun SDK ready!"),v=!0}),d.on("SavePointsSuccess",()=>console.log("Score saved!")),d.on("SavePointsFailed",()=>console.log("Save failed")),d.init({gameId:"44ad9446-6625-4a4c-9a5f-17d81295801c"}));const x=document.getElementById("game-canvas"),e=x.getContext("2d");function A(){const o=document.getElementById("game-container").getBoundingClientRect();x.width=o.width*window.devicePixelRatio,x.height=o.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio)}A();window.addEventListener("resize",A);const n={isPlaying:!1,score:0,combo:0,maxCombo:0,hearts:[],arrows:[],particles:[],brokenHearts:[],cupidY:0,cupidAngle:0,targetAngle:0,lastHeartTime:0,difficulty:1,missedHearts:0},m=[{fill:"#ff6b6b",stroke:"#e55555",name:"red"},{fill:"#ff69b4",stroke:"#e557a0",name:"pink"},{fill:"#da70d6",stroke:"#c45cc2",name:"purple"},{fill:"#ff8c94",stroke:"#e57880",name:"coral"}];let h=m[0],b=null;function p(){return b||(b=new(window.AudioContext||window.webkitAudioContext)),b}function E(){try{const t=p();t.state==="suspended"&&t.resume();const o=t.createOscillator(),i=t.createGain();o.type="triangle",o.frequency.setValueAtTime(800,t.currentTime),o.frequency.exponentialRampToValueAtTime(400,t.currentTime+.1),i.gain.setValueAtTime(.2,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.15),o.connect(i),i.connect(t.destination),o.start(),o.stop(t.currentTime+.15)}catch{}}function I(t){try{const o=p();o.state==="suspended"&&o.resume();const i=523.25+t*50,l=o.createOscillator(),r=o.createOscillator(),a=o.createGain();l.type="sine",l.frequency.setValueAtTime(i,o.currentTime),l.frequency.setValueAtTime(i*1.5,o.currentTime+.05),l.frequency.setValueAtTime(i*2,o.currentTime+.1),r.type="sine",r.frequency.setValueAtTime(i*1.5,o.currentTime),a.gain.setValueAtTime(.25,o.currentTime),a.gain.exponentialRampToValueAtTime(.01,o.currentTime+.2),l.connect(a),r.connect(a),a.connect(o.destination),l.start(),r.start(),l.stop(o.currentTime+.25),r.stop(o.currentTime+.25)}catch{}}function P(){try{const t=p();t.state==="suspended"&&t.resume();const o=t.createOscillator(),i=t.createGain();o.type="sawtooth",o.frequency.setValueAtTime(200,t.currentTime),o.frequency.exponentialRampToValueAtTime(100,t.currentTime+.2),i.gain.setValueAtTime(.15,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.2),o.connect(i),i.connect(t.destination),o.start(),o.stop(t.currentTime+.2)}catch{}}function y(t,o,i,l,r=0){e.save(),e.translate(t,o),e.rotate(r),e.beginPath();const a=i;e.moveTo(0,a*.3),e.bezierCurveTo(-a*.5,-a*.3,-a,a*.1,0,a),e.bezierCurveTo(a,a*.1,a*.5,-a*.3,0,a*.3),e.fillStyle=l.fill,e.fill(),e.strokeStyle=l.stroke,e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(-a*.25,0,a*.12,0,Math.PI*2),e.fillStyle="rgba(255,255,255,0.5)",e.fill(),e.restore()}function R(t,o,i,l,r){e.save(),e.translate(t,o),e.save(),e.translate(-r,0),e.beginPath(),e.moveTo(0,i*.3),e.bezierCurveTo(-i*.5,-i*.3,-i,i*.1,0,i),e.lineTo(0,i*.3),e.fillStyle=l.fill,e.globalAlpha=.6,e.fill(),e.restore(),e.save(),e.translate(r,0),e.beginPath(),e.moveTo(0,i*.3),e.bezierCurveTo(i*.5,-i*.3,i,i*.1,0,i),e.lineTo(0,i*.3),e.fillStyle=l.fill,e.globalAlpha=.6,e.fill(),e.restore(),e.restore()}function B(t,o,i){e.save(),e.translate(t,o),e.rotate(i),e.beginPath(),e.arc(0,0,30,-Math.PI*.4,Math.PI*.4),e.strokeStyle="#d4a574",e.lineWidth=5,e.stroke(),e.strokeStyle="#8b5a2b",e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(0,-22),e.lineTo(-10,0),e.lineTo(0,22),e.strokeStyle="#ccc",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(-10,0),e.lineTo(25,0),e.strokeStyle="#8b5a2b",e.lineWidth=3,e.stroke(),y(30,0,10,h,Math.PI/2),e.restore()}function H(t){e.save(),e.translate(t.x,t.y),e.rotate(t.angle),e.beginPath(),e.moveTo(-20,0),e.lineTo(15,0),e.strokeStyle="#8b5a2b",e.lineWidth=3,e.stroke(),y(20,0,10,t.color,Math.PI/2),e.beginPath(),e.moveTo(-20,0),e.lineTo(-28,-6),e.lineTo(-25,0),e.lineTo(-28,6),e.closePath(),e.fillStyle="#ffb6c1",e.fill(),e.restore()}function L(){const o=document.getElementById("game-container").getBoundingClientRect().width,i=m[Math.floor(Math.random()*m.length)],l=25+Math.random()*10;n.hearts.push({x:40+Math.random()*(o-80),y:-40,size:l,color:i,speed:1.5+n.difficulty*.3+Math.random()*.5,wobble:Math.random()*Math.PI*2,wobbleSpeed:.03+Math.random()*.02})}function O(t,o,i,l=15){for(let r=0;r<l;r++){const a=Math.PI*2*r/l+Math.random()*.3,c=3+Math.random()*5;n.particles.push({x:t,y:o,vx:Math.cos(a)*c,vy:Math.sin(a)*c,size:4+Math.random()*6,color:i.fill,life:1,type:Math.random()>.5?"heart":"circle"})}}function q(t,o){if(!n.isPlaying)return;const i=document.getElementById("game-container").getBoundingClientRect(),l=i.width/2,r=i.height-80,a=Math.atan2(o-r,t-l);n.arrows.push({x:l,y:r,angle:a,speed:15,color:h});const c=m.findIndex(f=>f.name===h.name);h=m[(c+1)%m.length],n.cupidAngle=a,E()}function V(t,o){const i=t.x-o.x,l=t.y-o.y;return Math.sqrt(i*i+l*l)<o.size+15}function M(){document.getElementById("score").textContent=n.score;const t=document.getElementById("combo");n.combo>=2?(t.textContent=`x${n.combo} COMBO!`,t.classList.add("active")):t.classList.remove("active")}function T(t="#ff69b4"){const o=document.getElementById("flash");o.style.background=t,o.style.opacity="0.3",setTimeout(()=>o.style.opacity="0",80)}function D(){if(!n.isPlaying)return;const t=document.getElementById("game-container").getBoundingClientRect(),o=t.width,i=t.height,l=Date.now(),r=Math.max(600,1400-n.difficulty*80);l-n.lastHeartTime>r&&(L(),n.lastHeartTime=l);for(let a=n.hearts.length-1;a>=0;a--){const c=n.hearts[a];if(c.y+=c.speed,c.wobble+=c.wobbleSpeed,c.x+=Math.sin(c.wobble)*.5,c.y>i+40&&(n.hearts.splice(a,1),n.combo=0,n.missedHearts++,n.brokenHearts.push({x:c.x,y:i-30,color:c.color,split:0,life:1}),P(),T("#666"),n.missedHearts>=5)){Y();return}}for(let a=n.arrows.length-1;a>=0;a--){const c=n.arrows[a];c.x+=Math.cos(c.angle)*c.speed,c.y+=Math.sin(c.angle)*c.speed;let f=!1;for(let s=n.hearts.length-1;s>=0;s--){const u=n.hearts[s];if(V(c,u)){if(c.color.name===u.color.name){n.combo++,n.maxCombo=Math.max(n.maxCombo,n.combo);const w=10*n.combo;n.score+=w,O(u.x,u.y,u.color),T(u.color.fill),I(n.combo),d&&v&&d.addPoints(w)}else n.combo=0,P(),T("#666");n.hearts.splice(s,1),f=!0,n.score>0&&n.score%100===0&&(n.difficulty=Math.min(10,n.difficulty+.5));break}}(c.x<-50||c.x>o+50||c.y<-50||c.y>i+50||f)&&n.arrows.splice(a,1)}for(let a=n.particles.length-1;a>=0;a--){const c=n.particles[a];c.x+=c.vx,c.y+=c.vy,c.vy+=.15,c.life-=.025,c.life<=0&&n.particles.splice(a,1)}for(let a=n.brokenHearts.length-1;a>=0;a--){const c=n.brokenHearts[a];c.split+=.5,c.life-=.02,c.life<=0&&n.brokenHearts.splice(a,1)}M()}function G(){const t=document.getElementById("game-container").getBoundingClientRect(),o=t.width,i=t.height;if(e.clearRect(0,0,o,i),!n.isPlaying)return;n.brokenHearts.forEach(s=>{e.globalAlpha=s.life,R(s.x,s.y,20,s.color,s.split),e.globalAlpha=1});const l=5-n.missedHearts;e.font="16px Quicksand",e.textAlign="left";let r=15;for(let s=0;s<5;s++){const u=s<l?m[0]:{fill:"#999",stroke:"#666"};y(r+s*22,i-25,10,u)}n.hearts.forEach(s=>{y(s.x,s.y,s.size,s.color,Math.sin(s.wobble)*.1)}),n.arrows.forEach(s=>{H(s)}),n.particles.forEach(s=>{e.globalAlpha=s.life,s.type==="heart"?y(s.x,s.y,s.size,{fill:s.color,stroke:s.color}):(e.fillStyle=s.color,e.beginPath(),e.arc(s.x,s.y,s.size,0,Math.PI*2),e.fill()),e.globalAlpha=1});const a=o/2,c=i-80,f=n.targetAngle-n.cupidAngle;n.cupidAngle+=f*.1,B(a,c,n.cupidAngle),e.font="12px Quicksand",e.fillStyle="#999",e.textAlign="center",e.fillText("Next arrow:",o/2,i-10)}function C(){D(),G(),requestAnimationFrame(C)}function X(){n.isPlaying=!0,n.score=0,n.combo=0,n.maxCombo=0,n.hearts=[],n.arrows=[],n.particles=[],n.brokenHearts=[],n.difficulty=1,n.missedHearts=0,n.lastHeartTime=Date.now(),h=m[0],document.getElementById("menu").classList.add("hidden"),document.getElementById("final-score").textContent="",M(),p()}async function Y(){if(n.isPlaying=!1,document.getElementById("menu").classList.remove("hidden"),document.querySelector(".menu-title").textContent="Game Over!",document.querySelector(".menu-subtitle").textContent="Tap to play again",document.getElementById("play-btn").textContent="Play Again",document.getElementById("final-score").textContent=`Score: ${n.score} | Max Combo: x${n.maxCombo}`,d&&v&&n.score>0)try{await d.savePoints(n.score)}catch(t){console.log("Save error:",t)}}const g=document.getElementById("game-container");function S(t,o){const i=g.getBoundingClientRect(),l=t-i.left,r=o-i.top;n.isPlaying&&q(l,r)}function k(t,o){if(!n.isPlaying)return;const i=g.getBoundingClientRect(),l=t-i.left,r=o-i.top,a=i.width/2,c=i.height-80;n.targetAngle=Math.atan2(r-c,l-a)}g.addEventListener("click",t=>S(t.clientX,t.clientY));g.addEventListener("mousemove",t=>k(t.clientX,t.clientY));g.addEventListener("touchstart",t=>{t.preventDefault();const o=t.touches[0];S(o.clientX,o.clientY)});g.addEventListener("touchmove",t=>{t.preventDefault();const o=t.touches[0];k(o.clientX,o.clientY)});document.getElementById("play-btn").addEventListener("click",t=>{t.stopPropagation(),X()});C();
