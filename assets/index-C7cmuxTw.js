(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();let m=null,v=!1;typeof OpenGameSDK<"u"&&(m=new OpenGameSDK({ui:{usePointsWidget:!0,theme:"light"},logLevel:1}),m.on("OnReady",()=>{console.log("Play.fun SDK ready!"),v=!0}),m.on("SavePointsSuccess",()=>console.log("Score saved!")),m.on("SavePointsFailed",()=>console.log("Save failed")),m.init({gameId:"44ad9446-6625-4a4c-9a5f-17d81295801c"}));const x=document.getElementById("game-canvas"),e=x.getContext("2d");function M(){const n=document.getElementById("game-container").getBoundingClientRect();x.width=n.width*window.devicePixelRatio,x.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio)}M();window.addEventListener("resize",M);const o={isPlaying:!1,score:0,combo:0,maxCombo:0,hearts:[],arrows:[],particles:[],brokenHearts:[],cupidY:0,cupidAngle:0,targetAngle:0,lastHeartTime:0,difficulty:1,missedHearts:0},f=[{fill:"#ff6b6b",stroke:"#e55555",name:"red"},{fill:"#ff69b4",stroke:"#e557a0",name:"pink"},{fill:"#da70d6",stroke:"#c45cc2",name:"purple"},{fill:"#ff8c94",stroke:"#e57880",name:"coral"}];let h=f[0],b=null;function y(){return b||(b=new(window.AudioContext||window.webkitAudioContext)),b}function O(){try{const t=y();t.state==="suspended"&&t.resume();const n=t.createOscillator(),i=t.createGain();n.type="triangle",n.frequency.setValueAtTime(800,t.currentTime),n.frequency.exponentialRampToValueAtTime(400,t.currentTime+.1),i.gain.setValueAtTime(.2,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.15),n.connect(i),i.connect(t.destination),n.start(),n.stop(t.currentTime+.15)}catch{}}function L(){try{const t=y();t.state==="suspended"&&t.resume();const n=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.setValueAtTime(600,t.currentTime),n.frequency.exponentialRampToValueAtTime(400,t.currentTime+.08),i.gain.setValueAtTime(.2,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.12),n.connect(i),i.connect(t.destination),n.start(),n.stop(t.currentTime+.12)}catch{}}function V(t){try{const n=y();n.state==="suspended"&&n.resume();const i=523.25+t*60;[1,1.25,1.5,2].forEach((c,d)=>{const l=n.createOscillator(),u=n.createGain();l.type="sine",l.frequency.setValueAtTime(i*c,n.currentTime+d*.04),u.gain.setValueAtTime(0,n.currentTime+d*.04),u.gain.linearRampToValueAtTime(.2,n.currentTime+d*.04+.01),u.gain.exponentialRampToValueAtTime(.01,n.currentTime+d*.04+.2),l.connect(u),u.connect(n.destination),l.start(n.currentTime+d*.04),l.stop(n.currentTime+d*.04+.25)});const r=n.createOscillator(),a=n.createGain();r.type="triangle",r.frequency.setValueAtTime(i*3,n.currentTime),r.frequency.exponentialRampToValueAtTime(i*4,n.currentTime+.3),a.gain.setValueAtTime(.08,n.currentTime),a.gain.exponentialRampToValueAtTime(.001,n.currentTime+.3),r.connect(a),a.connect(n.destination),r.start(),r.stop(n.currentTime+.35)}catch{}}function q(){try{const t=y();t.state==="suspended"&&t.resume();const n=t.createOscillator(),i=t.createGain();n.type="sine",n.frequency.setValueAtTime(400,t.currentTime),n.frequency.exponentialRampToValueAtTime(200,t.currentTime+.25),i.gain.setValueAtTime(.12,t.currentTime),i.gain.exponentialRampToValueAtTime(.01,t.currentTime+.25),n.connect(i),i.connect(t.destination),n.start(),n.stop(t.currentTime+.25)}catch{}}function p(t,n,i,s,r=0){e.save(),e.translate(t,n),e.rotate(r),e.beginPath();const a=i;e.moveTo(0,a*.3),e.bezierCurveTo(-a*.5,-a*.3,-a,a*.1,0,a),e.bezierCurveTo(a,a*.1,a*.5,-a*.3,0,a*.3),e.fillStyle=s.fill,e.fill(),e.strokeStyle=s.stroke,e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(-a*.25,0,a*.12,0,Math.PI*2),e.fillStyle="rgba(255,255,255,0.5)",e.fill(),e.restore()}function G(t,n,i,s,r){e.save(),e.translate(t,n),e.save(),e.translate(-r,0),e.beginPath(),e.moveTo(0,i*.3),e.bezierCurveTo(-i*.5,-i*.3,-i,i*.1,0,i),e.lineTo(0,i*.3),e.fillStyle=s.fill,e.globalAlpha=.6,e.fill(),e.restore(),e.save(),e.translate(r,0),e.beginPath(),e.moveTo(0,i*.3),e.bezierCurveTo(i*.5,-i*.3,i,i*.1,0,i),e.lineTo(0,i*.3),e.fillStyle=s.fill,e.globalAlpha=.6,e.fill(),e.restore(),e.restore()}function D(t,n,i){e.save(),e.translate(t,n),e.rotate(i),e.beginPath(),e.arc(0,0,30,-Math.PI*.4,Math.PI*.4),e.strokeStyle="#d4a574",e.lineWidth=5,e.stroke(),e.strokeStyle="#8b5a2b",e.lineWidth=3,e.stroke(),e.beginPath(),e.moveTo(0,-22),e.lineTo(-10,0),e.lineTo(0,22),e.strokeStyle="#ccc",e.lineWidth=2,e.stroke(),e.beginPath(),e.moveTo(-10,0),e.lineTo(25,0),e.strokeStyle="#8b5a2b",e.lineWidth=3,e.stroke(),p(30,0,10,h,Math.PI/2),e.restore()}function N(t){e.save(),e.translate(t.x,t.y),e.rotate(t.angle),e.beginPath(),e.moveTo(-20,0),e.lineTo(15,0),e.strokeStyle="#8b5a2b",e.lineWidth=3,e.stroke(),p(20,0,10,t.color,Math.PI/2),e.beginPath(),e.moveTo(-20,0),e.lineTo(-28,-6),e.lineTo(-25,0),e.lineTo(-28,6),e.closePath(),e.fillStyle="#ffb6c1",e.fill(),e.restore()}function X(){const n=document.getElementById("game-container").getBoundingClientRect().width,i=f[Math.floor(Math.random()*f.length)],s=25+Math.random()*10;o.hearts.push({x:40+Math.random()*(n-80),y:-40,size:s,color:i,speed:1.5+o.difficulty*.3+Math.random()*.5,wobble:Math.random()*Math.PI*2,wobbleSpeed:.03+Math.random()*.02})}function P(t,n,i,s=15){for(let r=0;r<s;r++){const a=Math.PI*2*r/s+Math.random()*.3,c=3+Math.random()*5;o.particles.push({x:t,y:n,vx:Math.cos(a)*c,vy:Math.sin(a)*c,size:4+Math.random()*6,color:i.fill,life:1,type:Math.random()>.5?"heart":"circle"})}}function Y(t,n){if(!o.isPlaying)return;const i=document.getElementById("game-container").getBoundingClientRect(),s=i.width/2,r=i.height-80,a=Math.atan2(n-r,t-s);o.arrows.push({x:s,y:r,angle:a,speed:15,color:h});const c=f.findIndex(d=>d.name===h.name);h=f[(c+1)%f.length],o.cupidAngle=a,O()}function W(t,n){const i=t.x-n.x,s=t.y-n.y;return Math.sqrt(i*i+s*s)<n.size+15}function S(){document.getElementById("score").textContent=o.score;const t=document.getElementById("combo");o.combo>=2?(t.textContent=`x${o.combo} COMBO!`,t.classList.add("active")):t.classList.remove("active")}function A(t="#ff69b4"){const n=document.getElementById("flash");n.style.background=t,n.style.opacity="0.3",setTimeout(()=>n.style.opacity="0",80)}function F(){if(!o.isPlaying)return;const t=document.getElementById("game-container").getBoundingClientRect(),n=t.width,i=t.height,s=Date.now(),r=Math.max(600,1400-o.difficulty*80);s-o.lastHeartTime>r&&(X(),o.lastHeartTime=s);for(let a=o.hearts.length-1;a>=0;a--){const c=o.hearts[a];if(c.y+=c.speed,c.wobble+=c.wobbleSpeed,c.x+=Math.sin(c.wobble)*.5,c.y>i+40&&(o.hearts.splice(a,1),o.combo=0,o.missedHearts++,o.brokenHearts.push({x:c.x,y:i-30,color:c.color,split:0,life:1}),q(),A("#666"),o.missedHearts>=5)){$();return}}for(let a=o.arrows.length-1;a>=0;a--){const c=o.arrows[a];c.x+=Math.cos(c.angle)*c.speed,c.y+=Math.sin(c.angle)*c.speed;let d=!1;for(let l=o.hearts.length-1;l>=0;l--){const u=o.hearts[l];if(W(c,u)){const I=c.color.name===u.color.name,w=5;let T=w;if(I){o.combo++,o.maxCombo=Math.max(o.maxCombo,o.combo);const H=10*o.combo;T=w+H,P(u.x,u.y,u.color,20),A(u.color.fill),V(o.combo)}else o.combo=0,P(u.x,u.y,u.color,8),L();o.score+=T,m&&v&&m.addPoints(T),o.hearts.splice(l,1),d=!0,o.score>0&&o.score%100===0&&(o.difficulty=Math.min(10,o.difficulty+.5));break}}(c.x<-50||c.x>n+50||c.y<-50||c.y>i+50||d)&&o.arrows.splice(a,1)}for(let a=o.particles.length-1;a>=0;a--){const c=o.particles[a];c.x+=c.vx,c.y+=c.vy,c.vy+=.15,c.life-=.025,c.life<=0&&o.particles.splice(a,1)}for(let a=o.brokenHearts.length-1;a>=0;a--){const c=o.brokenHearts[a];c.split+=.5,c.life-=.02,c.life<=0&&o.brokenHearts.splice(a,1)}S()}function K(){const t=document.getElementById("game-container").getBoundingClientRect(),n=t.width,i=t.height;if(e.clearRect(0,0,n,i),!o.isPlaying)return;o.brokenHearts.forEach(l=>{e.globalAlpha=l.life,G(l.x,l.y,20,l.color,l.split),e.globalAlpha=1});const s=5-o.missedHearts;e.font="16px Quicksand",e.textAlign="left";let r=15;for(let l=0;l<5;l++){const u=l<s?f[0]:{fill:"#999",stroke:"#666"};p(r+l*22,i-25,10,u)}o.hearts.forEach(l=>{p(l.x,l.y,l.size,l.color,Math.sin(l.wobble)*.1)}),o.arrows.forEach(l=>{N(l)}),o.particles.forEach(l=>{e.globalAlpha=l.life,l.type==="heart"?p(l.x,l.y,l.size,{fill:l.color,stroke:l.color}):(e.fillStyle=l.color,e.beginPath(),e.arc(l.x,l.y,l.size,0,Math.PI*2),e.fill()),e.globalAlpha=1});const a=n/2,c=i-80,d=o.targetAngle-o.cupidAngle;o.cupidAngle+=d*.1,D(a,c,o.cupidAngle),e.font="12px Quicksand",e.fillStyle="#999",e.textAlign="center",e.fillText("Next arrow:",n/2,i-10)}function C(){F(),K(),requestAnimationFrame(C)}function R(){o.isPlaying=!0,o.score=0,o.combo=0,o.maxCombo=0,o.hearts=[],o.arrows=[],o.particles=[],o.brokenHearts=[],o.difficulty=1,o.missedHearts=0,o.lastHeartTime=Date.now(),h=f[0],document.getElementById("menu").classList.add("hidden"),document.getElementById("final-score").textContent="",S(),y()}async function $(){if(o.isPlaying=!1,document.getElementById("menu").classList.remove("hidden"),document.querySelector(".menu-title").textContent="Game Over!",document.querySelector(".menu-subtitle").textContent="Tap to play again",document.getElementById("play-btn").textContent="Play Again",document.getElementById("final-score").textContent=`Score: ${o.score} | Max Combo: x${o.maxCombo}`,m&&v&&o.score>0)try{await m.savePoints(o.score)}catch(t){console.log("Save error:",t)}}const g=document.getElementById("game-container");function k(t,n){const i=g.getBoundingClientRect(),s=t-i.left,r=n-i.top;o.isPlaying&&Y(s,r)}function E(t,n){if(!o.isPlaying)return;const i=g.getBoundingClientRect(),s=t-i.left,r=n-i.top,a=i.width/2,c=i.height-80;o.targetAngle=Math.atan2(r-c,s-a)}g.addEventListener("click",t=>k(t.clientX,t.clientY));g.addEventListener("mousemove",t=>E(t.clientX,t.clientY));g.addEventListener("touchstart",t=>{if(t.target.tagName==="BUTTON")return;t.preventDefault();const n=t.touches[0];k(n.clientX,n.clientY)},{passive:!1});g.addEventListener("touchmove",t=>{if(t.target.tagName==="BUTTON")return;t.preventDefault();const n=t.touches[0];E(n.clientX,n.clientY)},{passive:!1});const B=document.getElementById("play-btn");B.addEventListener("click",t=>{t.stopPropagation(),R()});B.addEventListener("touchend",t=>{t.preventDefault(),t.stopPropagation(),R()});C();
